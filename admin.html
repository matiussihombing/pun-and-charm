<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | Pun & Charm</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: rgba(15, 23, 42, 0.9);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
        }

        .login-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin-top: 20vh;
        }

        .item-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .item-content {
            flex: 1;
        }

        .item-meta {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .item-text {
            font-size: 1.1rem;
            color: white;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-approve {
            background: #22c55e;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-reject {
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            color: var(--text-muted);
            padding: 3rem;
        }
    </style>
</head>

<body>
    <div id="login-view" class="login-screen">
        <h1>Admin Access</h1>
        <input type="password" id="admin-pass" placeholder="Enter Password"
            style="padding: 1rem; border-radius: 12px; border: none; width: 300px;">
        <button id="login-btn" class="primary-btn">Login</button>
    </div>

    <div id="dashboard-view" class="admin-container" style="display: none;">
        <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h2>Pending Submissions</h2>
            <button id="logout-btn" class="text-btn">Logout</button>
        </header>

        <div id="pending-list">
            <!-- Items will be injected here -->
        </div>
    </div>

    <script>
        const API_URL = '/api/admin';
        const loginView = document.getElementById('login-view');
        const dashboardView = document.getElementById('dashboard-view');
        const passInput = document.getElementById('admin-pass');
        const loginBtn = document.getElementById('login-btn');
        const pendingList = document.getElementById('pending-list');

        let authToken = localStorage.getItem('admin_token');

        if (authToken) {
            showDashboard();
        }

        loginBtn.addEventListener('click', () => {
            const pass = passInput.value;
            // In a real app, we'd verify this with the server first to get a token
            // Here we just use the password as the token for simplicity
            authToken = pass;
            localStorage.setItem('admin_token', authToken);
            showDashboard();
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            localStorage.removeItem('admin_token');
            location.reload();
        });

        function showDashboard() {
            loginView.style.display = 'none';
            dashboardView.style.display = 'block';
            fetchPending();
        }

        async function fetchPending() {
            try {
                const res = await fetch(`${API_URL}/pending`, {
                    headers: { 'Authorization': authToken }
                });

                if (res.status === 401) {
                    alert("Invalid password");
                    localStorage.removeItem('admin_token');
                    location.reload();
                    return;
                }

                const data = await res.json();
                renderList(data);
            } catch (e) {
                console.error(e);
            }
        }

        function renderList(items) {
            if (items.length === 0) {
                pendingList.innerHTML = '<div class="empty-state">No pending submissions! ðŸŽ‰</div>';
                return;
            }

            pendingList.innerHTML = items.map(item => `
                <div class="item-card">
                    <div class="item-content">
                        <div class="item-meta">${item.language.toUpperCase()} â€¢ ${item.type === 'jokes' ? 'Dad Joke' : 'Pick Up Line'}</div>
                        <div class="item-text">${item.text}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn-approve" onclick="approveItem(${item.id})">Approve</button>
                        <button class="btn-reject" onclick="rejectItem(${item.id})">Reject</button>
                    </div>
                </div>
            `).join('');
        }

        window.approveItem = async (id) => {
            await fetch(`${API_URL}/approve`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': authToken
                },
                body: JSON.stringify({ id })
            });
            fetchPending();
        };

        window.rejectItem = async (id) => {
            if (!confirm('Are you sure you want to delete this?')) return;

            await fetch(`${API_URL}/reject`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': authToken
                },
                body: JSON.stringify({ id })
            });
            fetchPending();
        };
    </script>
</body>

</html>